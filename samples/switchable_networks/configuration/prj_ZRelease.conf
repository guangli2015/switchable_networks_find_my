#
# Copyright (c) 2025 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-4-Clause
#

# Enable LTO (Link Time Optimization)
CONFIG_LTO=y
CONFIG_ISR_TABLES_LOCAL_DECLARATION=y

# Enable DK library for handling LEDs and buttons
CONFIG_DK_LIBRARY=y

# Error handling configuration
CONFIG_RESET_ON_FATAL_ERROR=y

# Memory optimization
CONFIG_SERIAL=n
CONFIG_CONSOLE=n
CONFIG_PRINTK=n
CONFIG_UART_CONSOLE=n
CONFIG_USE_SEGGER_RTT=n
CONFIG_BOOT_BANNER=n
CONFIG_NCS_BOOT_BANNER=n
CONFIG_BT_ASSERT=n
CONFIG_ASSERT_VERBOSE=n
CONFIG_HW_STACK_PROTECTION=n

# Common Bluetooth settings
CONFIG_BT_DEVICE_NAME="NCS locator tag"

# Enable settings to store data in non-volatile memory
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_BT_SETTINGS=y

CONFIG_REBOOT=y

# Needed for the MCUboot in the direct-xip mode with revert
CONFIG_MCUBOOT_BOOTUTIL_LIB=y

######################################################
# Apple ecosystem configuration (Apple Find My stack)
######################################################

# FMN configuration
CONFIG_FMNA_CAPABILITY_PLAY_SOUND_ENABLED=y
CONFIG_FMNA_CAPABILITY_BLE_SN_LOOKUP_ENABLED=y
CONFIG_FMNA_PAIRING_MODE_AUTO_ENTER=n

# If the MCUboot is used for the bootloader, the firmware version must be aligned
# to the version from the VERSION file.
CONFIG_FMNA_FIRMWARE_VERSION_MAJOR=1
CONFIG_FMNA_FIRMWARE_VERSION_MINOR=0
CONFIG_FMNA_FIRMWARE_VERSION_REVISION=0

# FMN configuration
CONFIG_FMNA=y
CONFIG_FMNA_NORDIC_PRODUCT_PLAN=y

# Kernel dependent configuration required by FMN
CONFIG_LINKER_ORPHAN_SECTION_PLACE=y
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_HEAP_MEM_POOL_SIZE=4096

# Bluetooth dependent configuration required by FMN
CONFIG_BT_RX_STACK_SIZE=3072

###############################################################
# Google ecosystem configuration (Google Fast Pair FMDN stack)
###############################################################

# Kernel dependent configuration required by FMDN
CONFIG_SYSTEM_WORKQUEUE_PRIORITY=-1

CONFIG_BT_PERIPHERAL_PREF_MIN_INT=24
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=40
CONFIG_BT_PERIPHERAL_PREF_LATENCY=0

CONFIG_BT_ADV_PROV=y
CONFIG_BT_ADV_PROV_FLAGS=y
CONFIG_BT_ADV_PROV_TX_POWER=y
CONFIG_BT_ADV_PROV_FAST_PAIR=y
CONFIG_BT_ADV_PROV_DEVICE_NAME=y
CONFIG_BT_ADV_PROV_DEVICE_NAME_SD=y

# Disable automatic initiation of PHY updates.
# Workaround to prevent disconnection with reason 42 (BT_HCI_ERR_DIFF_TRANS_COLLISION).
# Some Android phones reply to the LL_PHY_REQ and at the same time initiate a connection
# update which triggers an invalid procedure collision.
CONFIG_BT_AUTO_PHY_UPDATE=n

CONFIG_BT_ID_MAX=2
CONFIG_BT_MAX_PAIRED=8
CONFIG_BT_SMP=y
CONFIG_BT_PRIVACY=y
CONFIG_BT_GATT_AUTHORIZATION_CUSTOM=y
CONFIG_BT_RPA_TIMEOUT_DYNAMIC=y
CONFIG_BT_MAX_CONN=4
CONFIG_BT_EXT_ADV_MAX_ADV_SET=3


CONFIG_BT_FAST_PAIR=y
CONFIG_BT_FAST_PAIR_USE_CASE_LOCATOR_TAG=y
CONFIG_BT_FAST_PAIR_FMDN_BATTERY_DULT=y
CONFIG_BT_FAST_PAIR_FMDN_RING_COMP_ONE=y
CONFIG_BT_FAST_PAIR_FMDN_RING_VOLUME=y
CONFIG_BT_FAST_PAIR_FMDN_CLOCK_NVM_UPDATE_TIME=10

CONFIG_BT_FAST_PAIR_FMDN_DULT_MANUFACTURER_NAME="Nordic Semiconductor ASA"
CONFIG_BT_FAST_PAIR_FMDN_DULT_MODEL_NAME="NCS locator tag"
# Set Location Tracker Accessory Category.
CONFIG_BT_FAST_PAIR_FMDN_DULT_ACCESSORY_CATEGORY=1

# If the MCUboot is used for the bootloader, the firmware version must be aligned
# to the version from the VERSION file.
# Major.Minor.Revision value of 0.0.0 is not supported by the Fast Pair Validator
# Android app.
CONFIG_BT_FAST_PAIR_FMDN_DULT_FIRMWARE_VERSION_MAJOR=1
CONFIG_BT_FAST_PAIR_FMDN_DULT_FIRMWARE_VERSION_MINOR=0
CONFIG_BT_FAST_PAIR_FMDN_DULT_FIRMWARE_VERSION_REVISION=0

# Support firmware version read operation using the Device Information Service (DIS) for the
# firmware update intent support in the Android OS and Google Find My Device app.
CONFIG_BT_DIS=y
CONFIG_BT_DIS_FW_REV=y
CONFIG_BT_DIS_MODEL_NUMBER=n
CONFIG_BT_DIS_MANUF_NAME=n
CONFIG_BT_DIS_PNP=n

# Align the TX power encoded in the Fast Pair advertising set and
# the Read Beacon Parameters response with Fast Pair expectations.
# The value has been tailored for following DKs:
#   * nrf52833dk/nrf52833
#   * nrf52840dk/nrf52840
CONFIG_BT_ADV_PROV_TX_POWER_CORRECTION_VAL=-15
CONFIG_BT_FAST_PAIR_FMDN_TX_POWER_CORRECTION_VAL=-15
